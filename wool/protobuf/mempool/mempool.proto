syntax = "proto3";

package wool._protobuf.mempool;

service MemoryPool {
    rpc acquire (Request) returns (Response);
    rpc put (Put) returns (Response);
    rpc post (Post) returns (Response);
    rpc get (Request) returns (Response);
    rpc release (Request) returns (Response);
    rpc session (SessionRequest) returns (stream SessionResponse);
}

message Request {
    Reference reference = 1;
    Session session = 2;
}

message Reference {
    string id = 1;
}

message Put {
    Session session = 1;
    bool mutable = 2;
    bytes dump = 3;
}

message Post {
    Session session = 1;
    Reference reference = 2;
    bytes dump = 3;
}

message Response {
    bool success = 1;
    bytes dump = 2;
}

message SessionRequest {
}

message Session {
    string id = 1;
}

message Event {
    Reference reference = 1;
    string event_type = 2;
}

message SessionResponse {
    oneof response {
        Session session = 1;
        Event event = 2;
    }
}
