syntax = "proto3";

package wool.runtime.protobuf.worker;

import "task.proto";

service Worker {
    rpc dispatch (task.Task) returns (stream Response);
    rpc stop (StopRequest) returns (Void);
}

message Response {
    oneof payload {
        Ack ack = 1;
        Nack nack = 2;
        task.Result result = 3;
        task.Exception exception = 4;
    }
}

message Ack {
    // Acknowledgment that the task was received and processing started
}

message Nack {
    // Negative acknowledgment indicating the task was rejected
    string reason = 1;
}

message StopRequest {
    float timeout = 1;
}

message WorkerInfo {
    // Unique identifier for the worker instance
    string uid = 1;

    // Network host address where the worker is accessible
    string host = 2;

    // Network port number where the worker is listening (0 if not set)
    int32 port = 3;

    // Process ID of the worker
    int32 pid = 4;

    // Version string of the worker software
    string version = 5;

    // Capability tags for worker filtering and selection
    repeated string tags = 6;

    // Additional arbitrary metadata as key-value pairs
    map<string, string> extra = 7;
}

message Void {}
